# Harbor authentication

## Options

When setting up harbor there are four options for configuring authentication. These are: OIDC, UUA, LDAP and Database Login. This documentation will focus on OIDC and Database Login.

## OIDC 

OIDC allows us to use use single sign on with a provider of our choice. Once harbor is up and running it can be configured through the UI or through CRDs. 

An example CRD: 

```
apiVersion: v1
kind: Secret
metadata:
  name: google-client-id-secret
  namespace: container-solutions
type: Opaque
stringData:
  # the key is same with fields name.
  oidc_client_secret: <Some secret that has been generated by our OIDC provider>
---
apiVersion: goharbor.io/v1beta1
kind: HarborConfiguration
metadata:
  name: google-oidc-config
  namespace: container-solutions
spec:
  harborClusterRef: harborcluster-sample
  configuration:
    authMode: oidc_auth
    oidcName: Google
    oidcEndpoint: https://accounts.google.com
    oidcClientId: <Some ID that has been generated by our OIDC provider>
    oidcClientSecret: google-client-id-secret
    oidcScope: openid
    oidcVerifyCert: true
```

Here we use google as our OIDC provider. This involved creating a new project on google cloud platform, and then creating credentials, inside of the project. 

The page to do so:

`https://console.cloud.google.com/apis`

Once you've access to a client secret, pass it into a definition for a secret object and reference it in the HarborConfiguration CRD. This CRD also contains the correct endpoint and the client ID. 

In the future we may use Dex as a shim to Github instead.

**Note**

Once an authentication method has been chosen you cannot switch between them. You can however update your OIDC settings due to the CRDs idempotent behaviour. 

## Database Login

Database Login is primarily used to log in as an admin. When logged in as an admin you have escalated priveleges that allow you to configure harbor through the UI. You can manage and change:

- Users
- Robot accounts
- Groups
- Registries
- Replication
- Distribution
- Labels
- Project Quotas
- Interrogation Services
- Garbage Collection
- Configuration

**Note**

If you create users in the database without using `Configuration` to set up OIDC you will be unable to switch your mode of authentication, and will have to reinstall Harbor to do so. 

##Â Configuring database log in credentials

By default the harbor instance will start with by using Database Login with the default admin credentials. These are:

```
Username: admin
Password: Harbor12345
```

The password can be configured by changing the `admin-core-secret` object in the fullstack.yaml which is used to deploy harbor after the operators CRDs are running. 










